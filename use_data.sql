USE QUANLYBANHANG
GO
INSERT INTO NHANVIEN(MANHANVIEN,HO,TEN,NGAYSINH,NGAYLAMVIEC,DIACHI,DIENTHOAI,LUONGCOBAN,PHUCAP)
VALUES	('NV001',N'Nguyễn Văn',N'Nam','1995-05-03','2020-09-12',N'125 Cầu Giấy, Hà Nội','0327239012',10000000,2500000),
		('NV002',N'Hồ Thị',N'Bích','1994-08-01','2018-02-02',N'35 Nguyễn Chí Thanh, Hà Nội','0328499823',10000000,2500000);
INSERT INTO NHANVIEN(MANHANVIEN,HO,TEN,NGAYSINH,NGAYLAMVIEC,DIACHI,DIENTHOAI,LUONGCOBAN,PHUCAP)
VALUES	('NV003',N'Trần Văn',N'Khoa','1997-12-28','2020-12-12',N'15 Ba Đình, Hà Nội','0326933056',11000000,2000000),
		('NV004',N'Nguyễn Cẩm',N'Thơ','1999-05-25','2018-11-22',N'236 Hai Bà Trưng, Hà Nội','0328935012',12000000,1500000),
		('NV005',N'Đỗ Văn',N'Hùng','1992-07-04','2019-03-10',N'315 Huỳnh Thúc Kháng, Hà Nội','039865584',11500000,3000000);
INSERT INTO KHACHHANG(MAKHACHHANG,TENCONGTY,TENGIAODICH,DIACHI,DIENTHOAI,FAX,EMAIL)
VALUES	('KH001',N'Công ty TNHH Lưu Giang',NULL,N'135 Sơn Tây, Hà Nội','0327843668',NULL,NULL),
		('KH002',N'Công Ty TNHH Ninh Bình',NULL,N'64 Đường Hai BÀ Trưng, Hà Nội','0399185832',NULL,NULL);
INSERT INTO KHACHHANG(MAKHACHHANG,TENCONGTY,TENGIAODICH,DIACHI,DIENTHOAI,FAX,EMAIL)
VALUES	('KH003',N'Công ty TNHH Đặng Hoàn',NULL,N'25 Phan Đình Phùng, Hà Nội','0675933022',NULL,NULL),
		('KH004',N'Công ty TNHH An Thạch',NULL,N'78 Trần Duy Hưng, Hà Nội','096744932',NULL,NULL),
		('KH005',N'Công Ty TNHH Đào Khánh',NULL,N'178 Đường Phạm Văn Đồng, Hà Nội','059122098',NULL,NULL);
INSERT INTO DONDATHANG(SOHOADON,MAKHACHHANG,MANHANVIEN,NGAYDATHANG,NGAYGIAOHANG,NGAYCHUYENHANG,NOIGIAOHANG)
VALUES	(001,'KH001','NV002','2024-01-02','2024-03-02','2024-03-01',NULL),
		(002,'KH002','NV001','2023-12-03','2023-12-12','2023-12-11',NULL);
INSERT INTO DONDATHANG(SOHOADON,MAKHACHHANG,MANHANVIEN,NGAYDATHANG,NGAYGIAOHANG,NGAYCHUYENHANG,NOIGIAOHANG)
VALUES	(003,'KH001','NV001','2023-11-22','2024-11-23','2024-11-22',NULL),
		(004,'KH001','NV001','2023-10-20','2023-10-21','2023-10-20',NULL);
INSERT INTO DONDATHANG(SOHOADON,MAKHACHHANG,MANHANVIEN,NGAYDATHANG,NGAYGIAOHANG,NGAYCHUYENHANG,NOIGIAOHANG)
VALUES	(005,'KH003','NV004','2023-10-15','2023-10-18','2023-10-17',NULL);
UPDATE DONDATHANG
SET NGAYDATHANG = '2019-01-02'
WHERE SOHOADON = 001
SELECT * FROM DONDATHANG
GO
INSERT INTO NHACUNGCAP(MACONGTY,TENCONGTY,TENGIAODICH,DIACHI,DIENTHOAI,FAX,EMAIL)
VALUES	('NCC001',N'Công ty TNHH Dương Phát',NULL,N'372 Đường Bà Triệu, Hà Nội','0326844921',NULL,NULL),
		('NCC002',N'Công ty TNHH Minh Châu',NULL,N'45 Lý Thường Kiệt, Hà Nội','0372985444',NULL,NULL);
INSERT INTO NHACUNGCAP(MACONGTY,TENCONGTY,TENGIAODICH,DIACHI,DIENTHOAI,FAX,EMAIL)
VALUES	('NCC003', N'Công ty TNHH VINAMILK',N'VINAMILK',N'62 Đường Thái Hà, Hà Nội','0326844921',NULL,NULL),
		('NCC004', N'Công ty TNHH Bia HANOI',N'BIAHANOI',N'21 Đường Đê La Thành, Hà Nội','0326844921',NULL,NULL);
INSERT INTO NHACUNGCAP(MACONGTY,TENCONGTY,TENGIAODICH,DIACHI,DIENTHOAI,FAX,EMAIL)
VALUES	('NCC005', N'Công ty TNHH CocaCola',N'COCACOLA',N'121 Đường Hồ Tùng Mậu, Hà Nội','0767879889',NULL,NULL);
INSERT INTO LOAIHANG(MALOAIHANG,TENLOAIHANG)
VALUES	('LH001',N'Thực phẩm'),
		('LH002',N'Mỹ phẩm');
INSERT INTO LOAIHANG(MALOAIHANG,TENLOAIHANG)
VALUES	('LH003',N'Đồ gia dụng'),
		('LH004',N'Mẹ và bé'),
		('LH005',N'Văn phòng phẩm');
INSERT INTO MATHANG(MAHANG,TENHANG,MACONGTY,MALOAIHANG,SOLUONG,DONVITINH,GIAHANG)
VALUES	('MH001',N'Gạo','NCC001','LH001',23,N'vnđ',129000),
		('MH002',N'Son môi','NCC002','LH002',40,N'vnđ',150000);
INSERT INTO MATHANG(MAHANG,TENHANG,MACONGTY,MALOAIHANG,SOLUONG,DONVITINH,GIAHANG)
VALUES	('MH003',N'Thịt','NCC001','LH001',15,N'vnđ',90000),
		('MH004',N'Rau','NCC001','LH001',10,N'vnđ',25000);
INSERT INTO MATHANG(MAHANG,TENHANG,MACONGTY,MALOAIHANG,SOLUONG,DONVITINH,GIAHANG)
VALUES	('MH005',N'Bút','NCC004','LH005',34,N'vnđ',5000),
		('MH006',N'Nước ngọt Coca','NCC005','LH001',102,N'vnđ',18000);
INSERT INTO CHITIETDATHANG(SOHOADON,MAHANG,GIABAN,SOLUONG,MUCGIAMGIA)
VALUES	(001,'MH001',387000,3,0),
		(002,'MH002',300000,2,0);
INSERT INTO CHITIETDATHANG(SOHOADON,MAHANG,GIABAN,SOLUONG,MUCGIAMGIA)
VALUES	(001,'MH002',150000,1,0);
INSERT INTO CHITIETDATHANG(SOHOADON,MAHANG,GIABAN,SOLUONG,MUCGIAMGIA)
VALUES	(003,'MH001',129000,1,0),
		(004,'MH001',258000,2,0);
INSERT INTO CHITIETDATHANG(SOHOADON,MAHANG,GIABAN,SOLUONG,MUCGIAMGIA)
VALUES	(005,'MH005',25000,5,0);
UPDATE CHITIETDATHANG
SET GIABAN = 129000
WHERE SOHOADON =001
UPDATE CHITIETDATHANG
SET GIABAN = 150000
WHERE SOHOADON =002
UPDATE CHITIETDATHANG
SET GIABAN = 129000
WHERE SOHOADON =003
UPDATE CHITIETDATHANG
SET GIABAN = 129000
WHERE SOHOADON =004
UPDATE CHITIETDATHANG
SET GIABAN = 5000
WHERE SOHOADON =005
GO
SELECT * FROM CHITIETDATHANG
GO 
SELECT * FROM MATHANG
GO
SELECT * FROM LOAIHANG
GO
SELECT * FROM DONDATHANG
GO
SELECT * FROM NHANVIEN
GO
SELECT * FROM KHACHHANG
GO
--danh sach doi tac cung cap hang cho cong ty
SELECT * FROM NHACUNGCAP
GO
--ma hang, ten hang va so luong hien co trong cong ty
SELECT MAHANG, TENHANG,SOLUONG FROM MATHANG
GO
--dia chi, so dien thoai cua nha cung cap co ten giao dich la VINAMILK
SELECT DIACHI, DIENTHOAI FROM NHACUNGCAP
WHERE TENGIAODICH ='VINAMILK'
GO
--cho biet ma va ten cac mat hang co gia lon hon 100000 va so luong hien co it hon 50
SELECT MAHANG,TENHANG FROM MATHANG
WHERE GIAHANG NOT BETWEEN 0 AND 100000 
		AND SOLUONG BETWEEN 0 AND 50
GO
--don dat hang so 1 do ai dat, do nhan vien nao lap, thoigian, dia diem giao hang
SELECT KHACHHANG.MAKHACHHANG,KHACHHANG.TENCONGTY,KHACHHANG.DIACHI,HO,NHANVIEN.TEN,NHANVIEN.MANHANVIEN,DONDATHANG.NGAYDATHANG
	FROM (KHACHHANG INNER JOIN DONDATHANG ON KHACHHANG.MAKHACHHANG = DONDATHANG.MAKHACHHANG)
			INNER JOIN NHANVIEN ON DONDATHANG.MANHANVIEN = NHANVIEN.MANHANVIEN
	WHERE DONDATHANG.SOHOADON = 001
	GO
--hien thi nhung nhan vien co luong co ban cao nhat cong ty
SELECT * FROM NHANVIEN
WHERE LUONGCOBAN = (SELECT MAX(LUONGCOBAN) FROM NHANVIEN)
GO
--nhan vien nao trong cong ty ban duoc nhieu hang nhat va so luong ban la bao nhieu
SELECT TOP 1 NHANVIEN.MANHANVIEN,NHANVIEN.HO,NHANVIEN.TEN,COUNT(DONDATHANG.SOHOADON) AS SOLUONGNHIEUNHAT
	FROM (NHANVIEN INNER JOIN DONDATHANG ON NHANVIEN.MANHANVIEN = DONDATHANG.MANHANVIEN)
	GROUP BY NHANVIEN.MANHANVIEN,NHANVIEN.HO,NHANVIEN.TEN
	ORDER BY SOLUONGNHIEUNHAT DESC 
	GO
--hay cho biet tong so hang cua moi loai hang
SELECT LOAIHANG.TENLOAIHANG , SUM(MATHANG.SOLUONG) AS TONGSOLUONG
	FROM (MATHANG INNER JOIN LOAIHANG ON MATHANG.MALOAIHANG = LOAIHANG.MALOAIHANG)
	GROUP BY  LOAIHANG.TENLOAIHANG
	ORDER BY TONGSOLUONG ASC
	GO
--tang luong 50% cho nhan vien ban duoc so luong hang >=100 trong nam 2023
UPDATE NHANVIEN
SET LUONGCOBAN = LUONGCOBAN*1.5
WHERE NHANVIEN.MANHANVIEN IN (
		SELECT NHANVIEN.MANHANVIEN
		FROM NHANVIEN INNER JOIN DONDATHANG ON NHANVIEN.MANHANVIEN = DONDATHANG.MANHANVIEN
		WHERE YEAR(DONDATHANG.NGAYDATHANG) =2023
		GROUP BY NHANVIEN.MANHANVIEN
		HAVING COUNT (*) >100
	)

--xoa nhung don hang co ngay dat hang truoc nam 2020 
DELETE FROM DONDATHANG
WHERE YEAR(NGAYDATHANG) <2020
--xoa khoi bang nhan vien nhung nhan vien da lam viec cho cong ty tren 40 nam
DELETE FROM NHANVIEN 
WHERE YEAR (GETDATE()- YEAR (NGAYLAMVIEC)) >=40 
--tinh tien cua mot hoa don
SELECT SOHOADON,SUM (GIABAN * SOLUONG) AS TONGHOADON
FROM CHITIETDATHANG
GROUP BY SOHOADON
HAVING SOHOADON = 001
--tinh tong so tien cua cac hoa don trong mot ngay
SELECT DONDATHANG.NGAYDATHANG,SUM (GIABAN * SOLUONG) AS TONGHOADONTRONGNGAY
FROM CHITIETDATHANG INNER JOIN DONDATHANG ON CHITIETDATHANG.SOHOADON = DONDATHANG.SOHOADON
GROUP BY DONDATHANG.NGAYDATHANG
HAVING  DONDATHANG.NGAYDATHANG = '2023-11-22'




